# TASK-027: Добавление эндпоинта истории изменения статусов задачи

**Статус**: ✅ Выполнено  
**Ветка**: `feature/TASK-027-add-task-status-history-endpoint`

---

## Краткое описание

Добавить эндпоинт для получения истории изменения статусов задачи в service2110. Эндпоинт должен возвращать массив объектов с информацией о каждом изменении статуса: id записи, код статуса задачи, логин пользователя, дата и время.

**Примечание:** Моки для данного эндпоинта реализуются в отдельной задаче [TASK-028](TASK-028-add-task-status-history-mocks.md).

---

## Контекст

В рамках работы с задачами формы отчётности 6406 требуется возможность отслеживать историю изменений статусов каждой задачи. Это необходимо для аудита и понимания жизненного цикла задания.

---

## Исходные данные (согласовано)

| Вопрос | Решение |
|--------|--------|
| Формат ответа | Массив объектов, каждый объект содержит: id записи, код статуса задачи, логин пользователя, дата и время |
| Статусная модель | Использовать существующую статусную модель из `service2110/src/types/status-model.ts` |

---

## Требования

### Backend (service2110)

1. **Эндпоинт**: `GET /api/v1/report-6406/tasks/:id/status-history`
   - Возвращает массив объектов истории статусов
   - Каждый объект содержит:
     - `id` — идентификатор записи (UUID)
     - `status` — код статуса задачи
     - `changedBy` — логин пользователя (может быть null)
     - `changedAt` — дата и время изменения (ISO 8601)
     - Дополнительно: `previousStatus`, `comment`, `metadata` (опционально)

2. **Схема БД**: Использовать существующую таблицу `report_6406_task_status_history`

3. **Сервис**: Использовать существующий `TaskStatusHistoryService`

---

## Критерии приёмки

- [x] Эндпоинт `GET /api/v1/report-6406/tasks/:id/status-history` реализован в service2110
- [x] Эндпоинт возвращает массив объектов с полями: id, status, changedBy, changedAt
- [x] Эндпоинт корректно обрабатывает несуществующие задачи (возвращает 404)

---

## Реализованные изменения

### Backend (service2110)

- Эндпоинт уже существовал: `GET /api/v1/report-6406/tasks/:id/status-history`
- Сервис: `service2110/src/services/report-6406/task-status-history.service.ts`
- Схема: `service2110/src/schemas/report-6406/task-status-history.schema.ts`
- Маршрут: `service2110/src/routes/v1/report-6406/tasks/status-history.ts`

---

## Связанные задачи и артефакты

- **Следующая задача:** [TASK-028](TASK-028-add-task-status-history-mocks.md) — добавление моков для данного эндпоинта
- Статусная модель: `service2110/src/types/status-model.ts`
- Схема БД: `service2110/src/db/schema/report-6406-task-status-history.schema.ts`
