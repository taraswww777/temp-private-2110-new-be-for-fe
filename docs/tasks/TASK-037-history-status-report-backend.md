# TASK-037: История статусов отчета - получение данных с Backend

**Статус**: ✅ Выполнено  
**Ветка**: `feature/TASK-037-history-status-report-backend`

---

## Краткое описание

Реализовать получение данных для модалки "История статусов отчета" с Backend вместо использования моков.

---

## Исходное описание задачи

> Данный раздел содержит оригинальное описание задачи для оперативного обращения.

**Источник:** [Заметки от 05.02.2026](../temp-private-2110/docs/notes/2026-02-05.md#история-статусов-отчета-тарас)

```
Для отображения модалки `История статусов отчета` нужно брать данные с BE.
```

---

## Цели

- Реализовать endpoint для получения истории статусов отчета
- Интегрировать получение данных с Backend в модалку истории статусов
- Убрать использование моков для истории статусов
- Обеспечить корректное отображение истории статусов в UI

---

## Детальное описание

### Контекст

В настоящее время модалка "История статусов отчета" использует моковые данные. Необходимо перейти на получение реальных данных с Backend.

### Требования

#### Backend Endpoint

**Endpoint:** `GET /api/v1/report-6406/tasks/{taskId}/status-history`

**Response:** Массив объектов `StatusHistoryItemDto[]` (без пагинации)
```json
[
  {
    "id": "uuid",
    "status": "created",
    "previousStatus": null,
    "changedAt": "2026-02-05T10:00:00Z",
    "changedBy": "user.login",
    "comment": "Задание создано",
    "metadata": null
  },
  {
    "id": "uuid",
    "status": "started",
    "previousStatus": "created",
    "changedAt": "2026-02-05T11:00:00Z",
    "changedBy": "user.login",
    "comment": "Задание запущено",
    "metadata": null
  }
]
```

**Поля:**
- `id` - UUID записи истории
- `status` - статус задания (enum из статусной модели)
- `previousStatus` - предыдущий статус (может быть null)
- `changedAt` - дата и время изменения статуса (ISO 8601)
- `changedBy` - логин пользователя, изменившего статус (может быть null)
- `comment` - комментарий к изменению статуса (может быть null)
- `metadata` - дополнительные метаданные (может быть null)

#### Интеграция с Frontend

- Обновить API клиент для получения истории статусов
- Обновить компонент модалки для использования реальных данных
- Обработать состояния загрузки и ошибок
- Убрать моковые данные

---

## Критерии приёмки

### Backend
- [x] Реализован endpoint `GET /api/v1/report-6406/tasks/{taskId}/status-history` (выполнено в TASK-027)
- [x] Endpoint возвращает историю статусов для указанного задания
- [x] Данные берутся из таблицы `report_6406_task_status_history`
- [x] Реализована сортировка по дате изменения (от новых к старым, DESC)
- [x] Добавлена валидация существования задания (возвращает 404)
- [x] Обновлена OpenAPI спецификация
- [ ] Добавлены unit-тесты (опционально)

### Frontend (если требуется)
- [x] Обновлен API клиент для получения истории статусов (RTK Query `useGetTaskStatusHistoryQuery`)
- [x] Модалка использует данные с Backend (компонент `ReportDetailCardTabMenu` использует RTK Query)
- [x] Убраны моковые данные (моки используются только в dev-режиме для разработки)
- [x] Обработаны состояния загрузки и ошибок (через RTK Query и параметр `skip`)

---

## Порядок выполнения

1. Проанализировать структуру таблицы `report_6406_task_status_history`
2. Реализовать endpoint на Backend
3. Добавить валидацию и обработку ошибок
4. Обновить OpenAPI спецификацию
5. Написать unit-тесты
6. Обновить Frontend (если требуется)
7. Протестировать интеграцию

---

## Связанные документы

- [Заметки от 05.02.2026](../temp-private-2110/docs/notes/2026-02-05.md)
- TASK-027: Добавление эндпоинта истории изменения статусов задачи

---

## Примечания о выполнении

- **Дата завершения**: 2026-02-12
- **Backend эндпоинт**: Реализован в рамках [TASK-027](TASK-027-add-task-status-history-endpoint.md)
- **Формат ответа**: Фактически эндпоинт возвращает простой массив `StatusHistoryItemDto[]` вместо обёртки `{items: [], totalItems: number}`. Это соответствует реализации в TASK-027 и используется во frontend.
- **Frontend интеграция**: Используется RTK Query хук `useGetTaskStatusHistoryQuery` для получения данных с backend. Компоненты `ReportDetailCardTabMenu` и `ReportDetailsStatusesHistory` используют данные с backend.
- **Моки**: Моки реализованы в TASK-028 и используются только в dev-режиме через webpack dev server для разработки. В production frontend использует реальный backend API.

---


