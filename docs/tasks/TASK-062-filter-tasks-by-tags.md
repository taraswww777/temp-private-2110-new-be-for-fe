# TASK-062: Фильтрация задач по тегам в списке задач

**Статус**: ✅ Выполнено  
**Ветка**: `feature/TASK-062-filter-tasks-by-tags`  
**Приоритет**: средний  

---

## Краткое описание

Добавить возможность фильтрации задач по тегам на странице списка задач, аналогично существующей фильтрации по статусам и приоритетам.

---

## Контекст

В текущей версии Task Viewer на странице списка задач доступна фильтрация по статусам и приоритетам. Для улучшения функциональности поиска и организации задач необходимо добавить аналогичную фильтрацию по тегам.

---

## Цели

- Добавить фильтр по тегам на странице списка задач.
- Обеспечить возможность выбора одного или нескольких тегов для фильтрации.
- Реализовать фильтрацию задач по выбранным тегам аналогично фильтрации по статусам и приоритетам.
- Обеспечить совместимость фильтра по тегам с существующими фильтрами (статус, приоритет).

---

## Критерии приёмки

- [x] На странице списка задач добавлен фильтр по тегам рядом с фильтрами по статусам и приоритетам.
- [x] Фильтр по тегам позволяет выбрать один или несколько тегов из списка доступных тегов.
- [x] При выборе тегов список задач автоматически фильтруется, показывая только задачи с выбранными тегами.
- [x] Фильтр по тегам работает совместно с фильтрами по статусам и приоритетам (комбинированная фильтрация).
- [x] Можно снять выбор тегов для отображения всех задач.
- [x] Выбранные теги отображаются визуально (например, в виде бейджей или чекбоксов).
- [x] Интерфейс фильтра соответствует дизайну существующих фильтров (статус, приоритет).

---

## Технические заметки

- Компонент фильтра: должен быть интегрирован в существующую систему фильтрации на странице списка задач.
- Backend: возможно потребуется оптимизация запросов для фильтрации по тегам (если не реализовано).
- Frontend: компонент выбора тегов для фильтрации, интеграция с существующими фильтрами.
- Логика фильтрации: задачи должны отображаться, если они содержат хотя бы один из выбранных тегов (OR логика) или все выбранные теги (AND логика) - уточнить требования.
- Производительность: обеспечить быструю работу фильтрации при большом количестве задач и тегов.

---

## Реализация

### Выполненные изменения

1. **Компонент TaskFilters** (`taskViewerFe/src/components/TaskFilters.tsx`):
   - Добавлен проп `tagsFilter` для передачи выбранных тегов
   - Добавлен проп `onTagsFilterChange` для обработки изменения фильтра
   - Добавлен проп `availableTags` для списка доступных тегов
   - Добавлен проп `tagMetadata` для передачи метаданных тегов (цвета)
   - Добавлен компонент `MultiSelectField` для фильтрации по тегам
   - Используется кастомный рендеринг тегов с цветами через `renderOption` и `renderValue`

2. **Компонент TaskList** (`taskViewerFe/src/components/TaskList.tsx`):
   - Добавлена функция `getTagsFilterFromUrl()` для чтения фильтра тегов из URL
   - Добавлено состояние `tagsFilter` для хранения выбранных тегов
   - Добавлена логика фильтрации по тегам в `filteredAndSortedTasks` (OR логика: задача должна содержать хотя бы один из выбранных тегов)
   - Добавлена поддержка фильтра тегов в URL параметрах (`tags`)
   - Добавлена синхронизация фильтра тегов с URL
   - Использована функция `useTagsSortedByLastUsed()` для получения списка доступных тегов из всех задач
   - Передается `tagMetadata` в компонент `TaskFilters`

3. **Компонент MultiSelect** (`taskViewerFe/src/uiKit/multi-select.tsx`):
   - Добавлена поддержка кастомного рендеринга опций через проп `renderOption`
   - Добавлена поддержка кастомного рендеринга выбранных значений через проп `renderValue`
   - Добавлена встроенная кнопка очистки (проп `showClearButton`, по умолчанию `true`)
   - Кнопка очистки появляется рядом со стрелочкой, когда есть выбранные значения
   - Размер крестика очистки: `text-xl` для лучшей видимости

4. **Компонент MultiSelectField** (`taskViewerFe/src/uiKit/multi-select-field.tsx`):
   - Добавлена поддержка пропсов `renderOption` и `renderValue` для передачи в `MultiSelect`
   - Добавлен проп `showClearButton` для управления отображением кнопки очистки

5. **Компонент Input** (`taskViewerFe/src/uiKit/input.tsx`):
   - Добавлена встроенная кнопка очистки (пропы `showClearButton` и `onClear`)
   - Кнопка очистки появляется справа внутри input, когда есть значение
   - Размер крестика очистки: `text-xl` для лучшей видимости
   - Поддержка ref через `useImperativeHandle`

6. **Компонент InputField** (`taskViewerFe/src/uiKit/input-field.tsx`):
   - Добавлены пропсы `showClearButton` и `onClear` для передачи в `Input`

### Логика фильтрации

Реализована OR логика: задача отображается, если она содержит хотя бы один из выбранных тегов. Это позволяет гибко фильтровать задачи по нескольким тегам одновременно.

### Интеграция с существующими фильтрами

Фильтр по тегам полностью интегрирован с существующими фильтрами (поиск, статус, приоритет) и работает совместно с ними, применяя комбинированную фильтрацию.

### Отображение тегов с цветами

- Теги в выпадающем списке фильтра отображаются как цветные бейджи с использованием компонента `TagBadge`
- Цвета тегов берутся из `tagMetadata` и применяются через проп `colorKey`
- Выбранные теги также отображаются как цветные бейджи с возможностью удаления

### Встроенная очистка полей

- Возможность очистки реализована на уровне компонентов `Input` и `MultiSelect`
- Кнопки очистки появляются автоматически, когда есть значения для очистки
- Размер крестика очистки: `text-xl` (примерно в 2 раза больше стрелочки) для лучшей видимости
- Кнопки очистки имеют hover-эффект и aria-label для доступности
